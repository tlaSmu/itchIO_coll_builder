#!/bin/bash

# Отримання директорії, де знаходиться скрипт
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Перехід в директорію проекту
cd "$SCRIPT_DIR"

echo "============================================================"
echo "📂 Робоча директорія: $(pwd)"
echo "============================================================"

# ─────────────────────────────────────────────
# ВИБІР ПРОФІЛЮ
# Розкоментуй один із варіантів:
# ─────────────────────────────────────────────

#PROFILE="games"
PROFILE="quizzes"

echo "📦 Профіль: $PROFILE"
echo "============================================================"

# ─────────────────────────────────────────────
# ПЕРЕМІШУВАННЯ СПИСКУ ІГОР (тільки для games)
# ─────────────────────────────────────────────

if [ "$PROFILE" = "games" ]; then
    if [ -f "itchioGames.txt" ]; then
        echo "🎲 Перемішування списку ігор (itchioGames.txt)..."
        sort -R itchioGames.txt -o itchioGames.txt
    else
        echo "⚠️  Файл itchioGames.txt не знайдено, пропуск перемішування."
    fi
fi

# ─────────────────────────────────────────────
# АКТИВАЦІЯ ВІРТУАЛЬНОГО СЕРЕДОВИЩА
# ─────────────────────────────────────────────

if [ -f ".venv/bin/activate" ]; then
    echo "🟢 Активація віртуального середовища (.venv)..."
    source .venv/bin/activate
else
    echo "❌ Віртуальне середовище .venv не знайдено!"
    echo "   Створіть його: python3 -m venv .venv"
    echo "   Та встановіть залежності: pip install -r requirements.txt"
    read -p "Натисніть Enter щоб вийти..."
    exit 1
fi

# ─────────────────────────────────────────────
# ЗАПУСК
# ─────────────────────────────────────────────

echo "🚀 Запуск Master Process..."
python3 master_process.py --profile "$PROFILE"

# Деактивація (опціонально, бо скрипт завершується)
deactivate

echo ""
echo "============================================================"
read -p "✅ Роботу завершено. Натисніть Enter щоб закрити..."